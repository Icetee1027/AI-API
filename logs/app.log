{"level":"\u001b[32mINF\u001b[0m","time":"02:02:58.406","msg":"載入設定","service":"recipe-generator","openrouter_api_key":"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","openrouter_model":"google/gemini-2.0-flash-001"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:02:58.406","msg":"快取管理員已初始化","service":"recipe-generator","最大容量":1000,"存活時間":"24h0m0s","清理間隔":"10m0s"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:02:58.406","msg":"Starting router setup","service":"recipe-generator","debug_mode":true,"version":"1.0.0","environment":"development"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:02:58.406","msg":"Initializing services","service":"recipe-generator","cache_enabled":true,"queue_workers":5,"model":"google/gemini-2.0-flash-001","timeout":"2m0s"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:02:58.406","msg":"Recipe services initialized successfully","service":"recipe-generator","ai_service_initialized":true,"cache_manager_initialized":true,"environment":"development"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:02:58.407","msg":"Router setup completed successfully","service":"recipe-generator","debug_mode":true,"version":"1.0.0","environment":"development","ai_service_initialized":true,"recipe_service_initialized":true,"cache_manager_initialized":true,"timeout":"2m0s","max_body_size":10485760}
{"level":"\u001b[32mINF\u001b[0m","time":"02:02:58.407","msg":"啟動應用","service":"recipe-generator","version":"1.0.0","env":"development","debug":true}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:03:10.853","msg":"Configuration injected into context","service":"recipe-generator","path":"/api/v1/recipe/food","request_id":"f05d7722-fef4-4372-bb18-099564f15589"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:03:10.854","msg":"AI service injected into context","service":"recipe-generator","path":"/api/v1/recipe/food","request_id":"f05d7722-fef4-4372-bb18-099564f15589"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:03:10.854","msg":"Recipe services injected into context","service":"recipe-generator","path":"/api/v1/recipe/food","request_id":"f05d7722-fef4-4372-bb18-099564f15589"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:10.854","msg":"開始處理食物辨識請求","service":"recipe-generator","request_id":"f05d7722-fef4-4372-bb18-099564f15589","client_ip":"::1"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:10.855","msg":"開始處理食物識別請求","service":"recipe-generator","image_type":"base64_data_uri_jpeg","description_hint":""}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:10.859","msg":"快取未命中","service":"recipe-generator","鍵":"multimodal:74453f9b660bab35a5cd0dbe0755cc200ffb86eea813d7c53dfb3cce64f2386f:8b8cfe49231856dbcf6d4ed191fea116fda5d88a46988ef5be8377cfff96d851"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:03:10.859","msg":"OpenRouter image_url debug","service":"recipe-generator","prefix":"[HAS_PREFIX]","image_url_start":"data:image/jpeg;base64,/9j/2wCEAAUDBAQEAwUEBAQFBQUGBwwIBwcHB"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:13.117","msg":"快取已儲存","service":"recipe-generator","鍵":"multimodal:74453f9b660bab35a5cd0dbe0755cc200ffb86eea813d7c53dfb3cce64f2386f:8b8cfe49231856dbcf6d4ed191fea116fda5d88a46988ef5be8377cfff96d851"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:13.117","msg":"食物識別成功","service":"recipe-generator","foods_count":1,"image_type":"base64_data_uri_jpeg"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:13.117","msg":"食物辨識成功","service":"recipe-generator","request_id":"f05d7722-fef4-4372-bb18-099564f15589","foods_count":1}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:13.117","msg":"請求完成","service":"recipe-generator","status":200,"method":"POST","path":"/api/v1/recipe/food","ip":"::1","user-agent":"python-requests/2.32.3","latency":"2.265530625s","request_id":""}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:03:13.125","msg":"Configuration injected into context","service":"recipe-generator","path":"/api/v1/recipe/food","request_id":"8e628a70-574a-4513-8efa-a2b75e5666a7"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:03:13.125","msg":"AI service injected into context","service":"recipe-generator","path":"/api/v1/recipe/food","request_id":"8e628a70-574a-4513-8efa-a2b75e5666a7"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:03:13.125","msg":"Recipe services injected into context","service":"recipe-generator","path":"/api/v1/recipe/food","request_id":"8e628a70-574a-4513-8efa-a2b75e5666a7"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:13.125","msg":"開始處理食物辨識請求","service":"recipe-generator","request_id":"8e628a70-574a-4513-8efa-a2b75e5666a7","client_ip":"::1"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:13.125","msg":"開始處理食物識別請求","service":"recipe-generator","image_type":"unknown_format","description_hint":""}
{"level":"\u001b[31mERR\u001b[0m","time":"02:03:13.125","msg":"AI 服務請求失敗","service":"recipe-generator","error":"failed to process image: invalid image data format"}
{"level":"\u001b[31mERR\u001b[0m","time":"02:03:13.125","msg":"圖片格式錯誤 (AI service)","service":"recipe-generator","error":"failed to process image: invalid image data format","request_id":"8e628a70-574a-4513-8efa-a2b75e5666a7","image_type":"unknown_format","image_length":18,"description_hint":""}
{"level":"\u001b[33mWRN\u001b[0m","time":"02:03:13.126","msg":"用戶端錯誤","service":"recipe-generator","status":400,"method":"POST","path":"/api/v1/recipe/food","ip":"::1","user-agent":"python-requests/2.32.3","latency":"978.667µs","request_id":"","error_type":"client_error"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:19.963","msg":"Shutting down server...","service":"recipe-generator"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:19.963","msg":"Server exited","service":"recipe-generator"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:03:19.963","msg":"快取管理員已關閉","service":"recipe-generator","命中次數":0,"未命中次數":1,"淘汰次數":0}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:43.550","msg":"載入設定","service":"recipe-generator","openrouter_api_key":"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","openrouter_model":"google/gemini-2.0-flash-001"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:43.551","msg":"快取管理員已初始化","service":"recipe-generator","最大容量":1000,"存活時間":"24h0m0s","清理間隔":"10m0s"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:43.551","msg":"Starting router setup","service":"recipe-generator","debug_mode":true,"version":"1.0.0","environment":"development"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:43.551","msg":"Initializing services","service":"recipe-generator","cache_enabled":true,"queue_workers":5,"model":"google/gemini-2.0-flash-001","timeout":"2m0s"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:43.551","msg":"Recipe services initialized successfully","service":"recipe-generator","ai_service_initialized":true,"cache_manager_initialized":true,"environment":"development"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:43.551","msg":"Router setup completed successfully","service":"recipe-generator","debug_mode":true,"version":"1.0.0","environment":"development","ai_service_initialized":true,"recipe_service_initialized":true,"cache_manager_initialized":true,"timeout":"2m0s","max_body_size":10485760}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:43.551","msg":"啟動應用","service":"recipe-generator","version":"1.0.0","env":"development","debug":true}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.255","msg":"Configuration injected into context","service":"recipe-generator","path":"/api/v1/recipe/suggest","request_id":"b1015633-0b10-4143-b9db-88af5f4690d7"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.255","msg":"AI service injected into context","service":"recipe-generator","path":"/api/v1/recipe/suggest","request_id":"b1015633-0b10-4143-b9db-88af5f4690d7"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.255","msg":"Recipe services injected into context","service":"recipe-generator","path":"/api/v1/recipe/suggest","request_id":"b1015633-0b10-4143-b9db-88af5f4690d7"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:58.255","msg":"開始處理食譜推薦請求","service":"recipe-generator","request_id":"b1015633-0b10-4143-b9db-88af5f4690d7","client_ip":"::1"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.256","msg":"用戶輸入 (原始 req)","service":"recipe-generator","request_id":"b1015633-0b10-4143-b9db-88af5f4690d7","req":{"available_ingredients":[{"name":"小小番茄","type":"蔬菜","amount":"2","unit":"顆","preparation":"切塊"},{"name":"雞蛋","type":"蛋類","amount":"3","unit":"顆","preparation":"打散"}],"available_equipment":[{"name":"炒鍋","type":"鍋具","size":"中型","material":"不鏽鋼","power_source":"瓦斯爐"}],"preference":{"cooking_method":"炒","dietary_restrictions":["無麩質"],"serving_size":"2人份"}}}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.256","msg":"轉換後的 serviceReq","service":"recipe-generator","request_id":"b1015633-0b10-4143-b9db-88af5f4690d7","serviceReq":{"available_ingredients":[{"name":"小小番茄","type":"蔬菜","amount":"2","unit":"顆","preparation":"切塊"},{"name":"雞蛋","type":"蛋類","amount":"3","unit":"顆","preparation":"打散"}],"available_equipment":[{"name":"炒鍋","type":"鍋具","size":"中型","material":"不鏽鋼","power_source":"瓦斯爐"}],"preference":{"cooking_method":"炒","dietary_restrictions":["無麩質"],"serving_size":"2人份"}}}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.256","msg":"SuggestRecipes 組裝的 prompt","service":"recipe-generator","prompt":"請根據以下可用食材和設備，推薦適合的食譜(並且用繁體中文回答）。\n\n可用食材：\n- 小小番茄 (蔬菜): 2顆, 切塊\n- 雞蛋 (蛋類): 3顆, 打散\n\n\n可用設備：\n- 炒鍋 (鍋具): 中型, 不鏽鋼, 瓦斯爐\n\n\n烹飪偏好：\n- 烹飪方式：炒\n- 飲食限制：無麩質\n- 份量：2人份\n\n要求：\n1. 只根據提供的食材和設備推薦內容，不要添加未出現的食材或設備\n2. 不要使用預設值或猜測值，若無法確定請填寫 \"未知\"\n3. 每個步驟都要非常詳細，適合新手操作\n4. 動作描述要具體明確，包含具體的時間和溫度\n5. 注意事項要特別提醒新手容易忽略的細節\n6. 所有字段都必須使用雙引號\n7. 不需要考慮可讀性，請省略所有空格和換行，返回最緊湊的 JSON 格式\n8. 推薦的食譜要優先使用已有的食材和設備\n9. 如果某些食材或設備不足，可以建議替代方案\n10. 每個食譜都要考慮到烹飪難度和時間\n11. time_minutes 欄位必須是整數，不能有小數點（以秒為單位）\n12. warnings 欄位必須是字串類型，如果沒有警告事項請填寫 \"null\"\n13. 每個步驟都必須包含 warnings 欄位，不能省略此欄位\n14. 不要使用\\n，不需要換行\n\n請以以下 JSON 格式返回（僅作為範例，請勿直接複製內容）：\n{\n    \"dish_name\": \"菜名\",\n    \"dish_description\": \"描述\",\n    \"ingredients\": [\n        {\n            \"name\": \"食材名稱\",\n            \"type\": \"食材類型\",\n            \"amount\": \"數量\",\n            \"unit\": \"單位\",\n            \"preparation\": \"處理方式\"\n        }\n    ],\n    \"equipment\": [\n        {\n            \"name\": \"設備名稱\",\n            \"type\": \"設備類型\",\n            \"size\": \"尺寸\",\n            \"material\": \"材質\",\n            \"power_source\": \"能源類型\"\n        }\n    ],\n    \"recipe\": [\n        {\n            \"step_number\": 1,\n            \"title\": \"步驟標題\",\n            \"description\": \"步驟描述\",\n            \"actions\": [\n                {\n                    \"action\": \"動作\",\n                    \"tool_required\": \"工具\",\n                    \"material_required\": [\"材料\"],\n                    \"time_minutes\": 1,\n                    \"instruction_detail\": \"細節\"\n                }\n            ],\n            \"estimated_total_time\": \"時間\",\n            \"temperature\": \"火侯\",\n            \"warnings\": \"無\",\n            \"notes\": \"備註\"\n        }\n    ]\n}"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:58.256","msg":"快取未命中","service":"recipe-generator","鍵":"text:bd288158ff7111446cf19a6002baff32b15b9791d3294325eb000f1d697e5f5c"}
{"level":"\u001b[31mERR\u001b[0m","time":"02:27:58.901","msg":"食譜推薦失敗","service":"recipe-generator","error":"AI service error: OpenRouter API returned error: {\"error\":{\"message\":\"No auth credentials found\",\"code\":401}}","request_id":"b1015633-0b10-4143-b9db-88af5f4690d7"}
{"level":"\u001b[31mERR\u001b[0m","time":"02:27:58.901","msg":"伺服器錯誤","service":"recipe-generator","status":500,"method":"POST","path":"/api/v1/recipe/suggest","ip":"::1","user-agent":"python-requests/2.32.3","latency":"646.047834ms","request_id":"","error_type":"server_error"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.914","msg":"Configuration injected into context","service":"recipe-generator","path":"/api/v1/recipe/suggest","request_id":"53fb9437-00af-42b0-9a09-f831b48e19b6"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.915","msg":"AI service injected into context","service":"recipe-generator","path":"/api/v1/recipe/suggest","request_id":"53fb9437-00af-42b0-9a09-f831b48e19b6"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.915","msg":"Recipe services injected into context","service":"recipe-generator","path":"/api/v1/recipe/suggest","request_id":"53fb9437-00af-42b0-9a09-f831b48e19b6"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:27:58.915","msg":"開始處理食譜推薦請求","service":"recipe-generator","request_id":"53fb9437-00af-42b0-9a09-f831b48e19b6","client_ip":"::1"}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.915","msg":"用戶輸入 (原始 req)","service":"recipe-generator","request_id":"53fb9437-00af-42b0-9a09-f831b48e19b6","req":{"available_ingredients":[],"available_equipment":[],"preference":{"cooking_method":""}}}
{"level":"\u001b[36mDBG\u001b[0m","time":"02:27:58.915","msg":"轉換後的 serviceReq","service":"recipe-generator","request_id":"53fb9437-00af-42b0-9a09-f831b48e19b6","serviceReq":{"available_ingredients":[],"available_equipment":[],"preference":{"cooking_method":"","dietary_restrictions":null,"serving_size":""}}}
{"level":"\u001b[31mERR\u001b[0m","time":"02:27:58.915","msg":"食譜推薦失敗","service":"recipe-generator","error":"missing required fields: cooking_method and serving_size are required","request_id":"53fb9437-00af-42b0-9a09-f831b48e19b6"}
{"level":"\u001b[31mERR\u001b[0m","time":"02:27:58.915","msg":"伺服器錯誤","service":"recipe-generator","status":500,"method":"POST","path":"/api/v1/recipe/suggest","ip":"::1","user-agent":"python-requests/2.32.3","latency":"410.709µs","request_id":"","error_type":"server_error"}
{"level":"\u001b[33mWRN\u001b[0m","time":"02:28:06.615","msg":"用戶端錯誤","service":"recipe-generator","status":429,"method":"POST","path":"/api/v1/recipe/suggest","ip":"::1","user-agent":"python-requests/2.32.3","latency":"47.334µs","request_id":"","error_type":"client_error"}
{"level":"\u001b[33mWRN\u001b[0m","time":"02:28:06.626","msg":"用戶端錯誤","service":"recipe-generator","status":429,"method":"POST","path":"/api/v1/recipe/suggest","ip":"::1","user-agent":"python-requests/2.32.3","latency":"56.334µs","request_id":"","error_type":"client_error"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:28:57.165","msg":"Shutting down server...","service":"recipe-generator"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:28:57.165","msg":"Server exited","service":"recipe-generator"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:28:57.165","msg":"快取管理員已關閉","service":"recipe-generator","命中次數":0,"未命中次數":1,"淘汰次數":0}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:13.285","msg":"載入設定","service":"recipe-generator","openrouter_api_key":"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","openrouter_model":"google/gemini-2.0-flash-001"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:13.285","msg":"快取管理員已初始化","service":"recipe-generator","最大容量":1000,"存活時間":"24h0m0s","清理間隔":"10m0s"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:13.285","msg":"Starting router setup","service":"recipe-generator","debug_mode":true,"version":"1.0.0","environment":"development"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:13.285","msg":"Initializing services","service":"recipe-generator","cache_enabled":true,"queue_workers":5,"model":"google/gemini-2.0-flash-001","timeout":"2m0s"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:13.285","msg":"Recipe services initialized successfully","service":"recipe-generator","ai_service_initialized":true,"cache_manager_initialized":true,"environment":"development"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:13.285","msg":"Router setup completed successfully","service":"recipe-generator","debug_mode":true,"version":"1.0.0","environment":"development","ai_service_initialized":true,"recipe_service_initialized":true,"cache_manager_initialized":true,"timeout":"2m0s","max_body_size":10485760}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:13.285","msg":"啟動應用","service":"recipe-generator","version":"1.0.0","env":"development","debug":true}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:20.938","msg":"開始處理食譜推薦請求","service":"recipe-generator","request_id":"22933fcc-d6cf-41cc-b4ca-8bded6b9ab0b","client_ip":"::1"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:20.939","msg":"快取未命中","service":"recipe-generator","鍵":"text:bd288158ff7111446cf19a6002baff32b15b9791d3294325eb000f1d697e5f5c"}
{"level":"\u001b[31mERR\u001b[0m","time":"02:29:21.661","msg":"食譜推薦失敗","service":"recipe-generator","error":"AI service error: OpenRouter API returned error: {\"error\":{\"message\":\"No auth credentials found\",\"code\":401}}","request_id":"22933fcc-d6cf-41cc-b4ca-8bded6b9ab0b"}
{"level":"\u001b[31mERR\u001b[0m","time":"02:29:21.661","msg":"伺服器錯誤","service":"recipe-generator","status":500,"method":"POST","path":"/api/v1/recipe/suggest","ip":"::1","user-agent":"python-requests/2.32.3","latency":"723.266458ms","request_id":"","error_type":"server_error"}
{"level":"\u001b[32mINF\u001b[0m","time":"02:29:21.703","msg":"開始處理食譜推薦請求","service":"recipe-generator","request_id":"f9413c8f-3ee6-4d27-b9d0-0a9bb022d2d3","client_ip":"::1"}
{"level":"\u001b[31mERR\u001b[0m","time":"02:29:21.703","msg":"食譜推薦失敗","service":"recipe-generator","error":"missing required fields: cooking_method and serving_size are required","request_id":"f9413c8f-3ee6-4d27-b9d0-0a9bb022d2d3"}
{"level":"\u001b[31mERR\u001b[0m","time":"02:29:21.703","msg":"伺服器錯誤","service":"recipe-generator","status":500,"method":"POST","path":"/api/v1/recipe/suggest","ip":"::1","user-agent":"python-requests/2.32.3","latency":"170.209µs","request_id":"","error_type":"server_error"}
